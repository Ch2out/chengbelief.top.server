"use strict";(self["webpackChunkmessage_project"]=self["webpackChunkmessage_project"]||[]).push([[821],{821:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"flex-box crd",staticStyle:{height:"100%"}},[t("el-card",{staticStyle:{width:"32rem","margin-top":"1rem"}},[t("div",{staticClass:"flex-box"},[t("div",{staticClass:"box",on:{click:e.updateImg}},[t("img",{staticClass:"image",attrs:{src:e.userInfo.img}}),t("div",{staticClass:"zhe"},[t("div",[t("i",{staticClass:"el-icon-picture-outline-round",staticStyle:{"font-size":"1.4rem"}})]),t("div",{staticStyle:{"margin-top":"0.5rem"}},[e._v("更换头像")])])])]),t("div",{staticStyle:{padding:"14px 0"}},[t("div",{staticClass:"text-title"},[e._v("用户信息修改")]),t("div",{staticClass:"bottom clearfix"},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.userInfo,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"附加信息",prop:"info"}},[t("el-input",{attrs:{placeholder:"附加信息"},model:{value:e.userInfo.info,callback:function(t){e.$set(e.userInfo,"info",t)},expression:"userInfo.info"}})],1),t("el-form-item",{attrs:{label:"用户昵称",prop:"nickname"}},[t("el-input",{attrs:{placeholder:"用户昵称"},model:{value:e.userInfo.nickname,callback:function(t){e.$set(e.userInfo,"nickname",t)},expression:"userInfo.nickname"}})],1),t("el-form-item",{attrs:{label:"用户QQ",prop:"qq"}},[t("el-input",{attrs:{placeholder:"用户qq"},model:{value:e.userInfo.qq,callback:function(t){e.$set(e.userInfo,"qq",t)},expression:"userInfo.qq"}})],1),t("el-form-item",{attrs:{label:"用户微信",prop:"wechat"}},[t("el-input",{attrs:{placeholder:"用户微信"},model:{value:e.userInfo.wechat,callback:function(t){e.$set(e.userInfo,"wechat",t)},expression:"userInfo.wechat"}})],1),t("el-form-item",{attrs:{label:"性别",prop:"sex"}},[t("el-radio-group",{model:{value:e.userInfo.sex,callback:function(t){e.$set(e.userInfo,"sex",t)},expression:"userInfo.sex"}},[t("el-radio",{attrs:{label:"m"}},[e._v("男")]),t("el-radio",{attrs:{label:"f"}},[e._v("女")]),t("el-radio",{attrs:{label:"n"}},[e._v("保密")])],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.updateUserInfo}},[e._v("确定修改")]),t("el-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1)])])],1)},i=[],a=s(3685),l={data(){let e=(e,t,s)=>{let r=/^[1-9][0-9]{4,10}$/;r.test(t)?s():s(new Error("此qq不满足规范"))};return{userImg:"",file:"",userInfo:{info:"",nickname:"",qq:"",sex:"",wechat:"",img:""},user:{},rules:{info:[{required:!0,message:"请输入用户详细信息",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],wechat:[{required:!0,message:"请输入用户微信",trigger:"blur"}],sex:[{required:!0,message:"必须选择性别",trigger:"change"}],qq:[{required:!0,message:"请输入用户QQ",trigger:"blur"},{validator:e,trigger:"blur"}]}}},methods:{submitForm(e){this.$refs[e].validate((e=>{if(!e)return!1;alert("submit!")}))},resetForm(){this.userInfo=JSON.parse(JSON.stringify(this.user))},updateUserInfo(){a.Z.ajax("/user/auth/updateUserInfo",this.userInfo,(e=>{if(this.$message(e.message),this.userImg!=this.userInfo.img&&this.userImg.includes("https://huhuiyu.top/teach_project_service/user/file/download?fid=")){let e=Number(this.userImg.slice(65));a.Z.ajax("/user/file/delete",{fid:e},(e=>{}),!0)}this.$store.dispatch("updatedUser")}))},updateImg(){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.addEventListener("change",(e=>{e.target.files[0].size<=2097152?(this.file=e.target.files[0],this.$message("上传中。。。时间较长请耐心等待"),a.Z.upload("/user/file/upload",{fileinfo:"图像修改"},this.file,(e=>{this.$message({message:"上传成功需要保存修改图片才能被保存修改",type:"warning"}),this.userInfo.img=a.Z.serverInfo.serverUrl+"/user/file/download?fid="+e.data.fid}))):this.$message({message:"文件超过2MB请选择重新上传",type:"error",showClose:!0})})),e.click()}},created(){this.user=this.$store.state.user.tbUserInfo,this.user.nickname=this.$store.state.user.tbUser.nickname,delete this.user.lastupdate,delete this.user.phone,delete this.user.email,this.userInfo=JSON.parse(JSON.stringify(this.user)),this.userImg=this.userInfo.img}},o=l,n=s(1001),u=(0,n.Z)(o,r,i,!1,null,"63e3a33c",null),c=u.exports}}]);
//# sourceMappingURL=821.5c345a79.js.map